<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDF - Market Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
            padding: 5px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            font-size: 28px;
            color: #1a2a6c;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 32px;
            color: #fdbb2d;
        }
        
        .date-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-selector select, .date-selector button {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            font-weight: 500;
            cursor: pointer;
        }
        
        .date-selector button {
            background: #1a2a6c;
            color: white;
            border: none;
            transition: all 0.3s;
        }
        
        .date-selector button:hover {
            background: #fdbb2d;
            color: #333;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 25px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-header h2 {
            font-size: 22px;
            color: #1a2a6c;
            font-weight: 700;
        }
        
        .card-header i {
            font-size: 24px;
            color: #b21f1f;
        }
        
        .index-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .index-card {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border-radius: 12px;
            padding: 20px;
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .index-card.up {
            background: linear-gradient(135deg, #1a2a6c, #00b09b);
        }
        
        .index-card.down {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
        }
        
        .index-name {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .index-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .index-change {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .chart-container {
            height: 400px;
            position: relative;
        }
        
        .gainers-table-container {
            max-height: 600px;
            overflow: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #1a2a6c;
            color: white;
            font-weight: 500;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:nth-child(odd) {
            background-color: #ada4a4;
        }
        
        tr:hover {
            background-color: #f0f0f0;
        }
        
        .positive {
            color: #00b09b;
            font-weight: 500;
        }
        
        .negative {
            color: #b21f1f;
            font-weight: 500;
        }
        
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .pagination-info {
            font-size: 14px;
            color: #6c757d;
        }
        
        .pagination-controls {
            display: flex;
            gap: 10px;
        }
        
        .pagination-btn {
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pagination-btn:hover {
            background: #2a3a9c;
            color: white;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #1a2a6c;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2a3a9c;
        }
        
        .btn-secondary {
            background: #fdbb2d;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #ffcc66;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #6c757d;
            font-size: 14px;
        }
        
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .index-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .index-cards {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hearder Section -->
        <header>
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>TheDataFestAI - Market Analysis (Daily Report)</h1>
            </div>
            <div class="date-selector">
                <select id="report-type">
                    <option value="daily">Daily Report</option>
                    <option value="weekly">Weekly Report</option>
                    <option value="monthly">Monthly Report</option>
                </select>
                <input type="date" id="report-date" value="{{ now }}">
                <button id="generate-btn"><i class="fas fa-sync-alt"></i> Generate Report</button>
            </div>
        </header>   

        <!-- Index Section -->
        <div class="index-cards">
            {% for index in indices %}
            <div class="index-card {% if index.change >= 0 %}up{% else %}down{% endif %}">
                <div class="index-name">
                    <span>{{ index.name }}</span>
                    <i class="fas fa-arrow-{% if index.change >= 0 %}up{% else %}down{% endif %}"></i>
                </div>
                <div class="index-value">{{ index.value }}</div>
                <div class="index-change">
                    <i class="fas fa-caret-{% if index.change >= 0 %}up{% else %}down{% endif %}"></i> 
                    {{ index.change|abs }}% 
                    ({% if index.change >= 0 %}+{% endif %}{{ index.change }}%)
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="dashboard">
            <div class="chart-grid">
                <div class="card">
                    <div class="chart-container">
                        <p>candlestick_chart</p>
                    </div>
                </div>
                <div class="card">
                    <div class="chart-container">
                        <p>rsi_chart</p>
                    </div>
                </div>
                <div class="card">
                    <div class="chart-container">
                        <p>macd_chart</p>
                    </div>
                </div>
                <div class="card">
                    <div class="chart-container">
                        <p>volume_chart</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-table"></i> Top Gainers</h2>
                    <i class="fas fa-arrow-up positive"></i>
                </div>
                <div class="gainers-table-container">
                    <table id="gainers-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Symbol</th>
                                <th>Price</th>
                                <th>Change %</th>
                            </tr>
                        </thead>
                        <tbody id="gainers-table-body">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <div class="pagination-info" id="pagination-info">
                        Showing 0 of 0 entries
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="first-page" disabled>
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="pagination-btn" id="prev-page" disabled>
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <button class="pagination-btn" id="next-page">
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="pagination-btn" id="last-page">
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <div class="card-header">
                <h2><i class="fas fa-analysis"></i> Market Analysis & Outlook</h2>
            </div>
            <div style="padding: 15px; line-height: 1.6;">
                <h3 style="color: white; margin-bottom: 15px;">Technical Analysis</h3>
                <p>The NIFTY 50 index has shown strong bullish momentum, breaking above the key resistance level of 18,600. The RSI is at 68, indicating positive momentum without being overbought. The moving averages are aligned bullishly with the 21-day EMA providing support around 18,450.</p>
                
                <h3 style="color: white; margin-top: 20px; margin-bottom: 15px;">Key Levels</h3>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>Resistance:</strong> 18,800 | 18,950</li>
                    <li><strong>Support:</strong> 18,450 | 18,250</li>
                </ul>
                
                <h3 style="color: white; margin-top: 20px; margin-bottom: 15px;">Market Outlook</h3>
                <p>The market is expected to remain positive in the near term, with IT and Banking sectors leading the rally. Global cues are positive with stable crude prices and dovish signals from central banks. Investors are advised to focus on quality large-caps with strong earnings visibility.</p>
            </div>
        </div>
        
        <!-- Below Content -->
        <div class="actions">
            <button class="btn btn-primary" id="export-pdf"><i class="fas fa-file-pdf"></i> Export to PDF</button>
            <button class="btn btn-secondary" id="share-email"><i class="fas fa-envelope"></i> Share via Email</button>
        </div>
        
        <footer>
            <p>TDF's Market Analysis Report | Generated on {{ now }} | For educational purposes only</p>
        </footer>
    </div>
    <script>
        // Set current date
        document.getElementById('report-date').value = new Date().toISOString().slice(0, 10);
        
        // Pagination for gainers table
        let currentPage = 1;
        const perPage = 10;
        let totalPages = 1;
        
        // Load gainers data
        function loadGainersData(page) {
            fetch(`/get_gainers_page?page=${page}&per_page=${perPage}`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('gainers-table-body');
                    tableBody.innerHTML = '';
                    
                    data.data.forEach(gainer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${gainer.rank}</td>
                            <td>${gainer.symbol}</td>
                            <td>${gainer.price.toFixed(2)}</td>
                            <td class="positive">+${gainer.change.toFixed(2)}%</td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Update pagination info
                    document.getElementById('pagination-info').textContent = 
                        `Showing ${((page - 1) * perPage) + 1} to ${Math.min(page * perPage, data.total)} of ${data.total} entries`;
                    
                    // Update pagination controls
                    document.getElementById('first-page').disabled = page === 1;
                    document.getElementById('prev-page').disabled = page === 1;
                    document.getElementById('next-page').disabled = page === data.total_pages;
                    document.getElementById('last-page').disabled = page === data.total_pages;
                    
                    currentPage = page;
                    totalPages = data.total_pages;
                })
                .catch(error => {
                    console.error('Error loading gainers data:', error);
                });
        }
        
        // Initial load
        loadGainersData(1);
        
        // Pagination event handlers
        document.getElementById('first-page').addEventListener('click', () => {
            loadGainersData(1);
        });
        
        document.getElementById('prev-page').addEventListener('click', () => {
            if (currentPage > 1) {
                loadGainersData(currentPage - 1);
            }
        });
        
        document.getElementById('next-page').addEventListener('click', () => {
            if (currentPage < totalPages) {
                loadGainersData(currentPage + 1);
            }
        });
        
        document.getElementById('last-page').addEventListener('click', () => {
            loadGainersData(totalPages);
        });
        
        // Export to PDF button
        document.getElementById('export-pdf').addEventListener('click', () => {
            alert('PDF export functionality would be implemented here. This would generate a multi-page PDF report.');
        });
        
        // Share via Email button
        document.getElementById('share-email').addEventListener('click', () => {
            alert('Email sharing functionality would be implemented here. This would send the report via email.');
        });
        
        // Generate Report button
        document.getElementById('generate-btn').addEventListener('click', () => {
            const reportType = document.getElementById('report-type').value;
            const reportDate = document.getElementById('report-date').value;
            alert(`Generating ${reportType} report for ${reportDate}. This would refresh the data and charts.`);
            location.reload();
        });
    </script>
</body>
</html>